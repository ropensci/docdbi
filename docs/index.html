<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoSQL Database Connector • nodbi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="NoSQL Database Connector">
<meta property="og:description" content="Simplified document database access and manipulation,
     providing a common API across supported NoSQL databases 
     Elasticsearch, CouchDB, MongoDB as well as 
     SQLite/JSON1 and PostgreSQL.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">nodbi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/nodbi/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="nodbi">nodbi<a class="anchor" aria-label="anchor" href="#nodbi"></a>
</h1></div>

<p><code>nodbi</code> is an R package that provides a single interface for several NoSQL databases and databases with JSON functionality, with the same function parameters and return values across all database backends.</p>
<p>Currently, <code>nodbi</code> supports the following database backends:</p>
<ul>
<li>MongoDB</li>
<li>SQLite</li>
<li>Elasticsearch</li>
<li>CouchDB</li>
<li>PostgreSQL (since v0.6.0)</li>
</ul>
<p>for an <code>R</code> object of any of these data types:</p>
<ul>
<li>data.frame</li>
<li>list</li>
<li>JSON string</li>
<li>a file name or URL with NDJSON records*</li>
</ul>
<p>and for executing the following operations:</p>
<ul>
<li>List</li>
<li>Exists</li>
<li>Create</li>
<li>Get</li>
<li>Query**</li>
<li>Update**</li>
<li>Delete</li>
</ul>
<p>across all database backends. Limitations: * Only <code>http(s)</code> and only for <code>docdb_create</code>. **Only simple queries (e.g. equality for a single field) and updates are supported for Elasticsearch at the moment. Only root fields can be specified for CouchDB, whereas subitems can be specified in dot notation for Elasticsearch, MongoDB, SQLite and PostgreSQL.</p>
<p>For capabilities in terms of operations and parameter combinations across any of the database backends, see section <a href="#walk-through">walk-through</a> below and see the main file for package testing, here: <a href="./tests/testthat/core-nodbi.R">core-nodbi.R</a>.</p>
<div class="section level2">
<h2 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h2>
<p>CRAN version</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nodbi"</span><span class="op">)</span></span></code></pre></div>
<p>Development version</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/nodbi"</span><span class="op">)</span></span></code></pre></div>
<p>Load package from library</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/nodbi/" class="external-link">"nodbi"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="api-overview">API overview<a class="anchor" aria-label="anchor" href="#api-overview"></a>
</h2>
<p>Parameters for <code>docdb_*()</code> functions are the same across all database backends. See <a href="#walk-through">walk-through</a> below.</p>
<table class="table">
<colgroup>
<col width="52%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>Purpose</th>
<th>Function call</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Create database connection (see below)</td>
<td><code>src &lt;- nodbi::src_{mongo, sqlite, couchdb, elastic}(&lt;see below for parameters&gt;)</code></td>
</tr>
<tr class="even">
<td>Load <code>my_data</code> (a data frame, a list, a JSON string, or a file name or url with NDJSON records) into database, container <code>my_container</code>
</td>
<td><code>nodbi::docdb_create(src = src, key = "my_container", value = my_data)</code></td>
</tr>
<tr class="odd">
<td>Get all documents back into a data frame</td>
<td><code>nodbi::docdb_get(src = src, key = "my_container")</code></td>
</tr>
<tr class="even">
<td>Get documents selected with query (as MongoDB-compatible JSON) into a data frame</td>
<td><code>nodbi::docdb_query(src = src, key = "my_container", query = '{"age": 20}')</code></td>
</tr>
<tr class="odd">
<td>Get selected fields (in MongoDB compatible JSON) from documents selected query</td>
<td><code>nodbi::docdb_query(src = src, key = "my_container", query = '{"age": 20}', fields = '{"name": 1, "_id": 0, "age": 1}')</code></td>
</tr>
<tr class="even">
<td>Update (patch) selected documents with new data in data frame, list or JSON string from <code>my_data</code>
</td>
<td><code>nodbi::docdb_update(src = src, key = "my_container", value = my_data, query = '{"age": 20}')</code></td>
</tr>
<tr class="odd">
<td>Check if container exists</td>
<td><code>nodbi::docdb_exists(src = src, key = "my_container")</code></td>
</tr>
<tr class="even">
<td>List all containers in database</td>
<td><code>nodbi::docdb_list(src = src)</code></td>
</tr>
<tr class="odd">
<td>Delete document(s) in container</td>
<td><code>nodbi::docdb_delete(src = src, key = "my_container", query = '{"age": 20}')</code></td>
</tr>
<tr class="even">
<td>Delete container</td>
<td><code>nodbi::docdb_delete(src = src, key = "my_container")</code></td>
</tr>
<tr class="odd">
<td>Close and remove database connection</td>
<td><code>rm(src)</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="database-connections">Database connections<a class="anchor" aria-label="anchor" href="#database-connections"></a>
</h2>
<p>Overview on parameters and aspects that are specific to the database backend. These are only needed once: for <code>src_*()</code> to create a connection object. The connection object is subsequently used with <code>docdb_*</code> functions.</p>
<div class="section level3">
<h3 id="mongodb">MongoDB<a class="anchor" aria-label="anchor" href="#mongodb"></a>
</h3>
<p>MongoDB but none of the other databases require to specify the container already in the <code>src_*()</code> function. “Container” refers to a MongoDB collection.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="reference/src_mongo.html">src_mongo</a></span><span class="op">(</span></span>
<span> collection <span class="op">=</span> <span class="st">"my_container"</span>, db <span class="op">=</span> <span class="st">"my_database"</span>,</span>
<span> url <span class="op">=</span> <span class="st">"mongodb://localhost"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sqlite">SQLite<a class="anchor" aria-label="anchor" href="#sqlite"></a>
</h3>
<p>The functionality to process JSON is based on the SQLite extension <a href="https://www.sqlite.org/json1.html" class="external-link">JSON1</a>, available in RSQLite. “Container” refers to an SQLite table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="reference/src_sqlite.html">src_sqlite</a></span><span class="op">(</span>dbname <span class="op">=</span> <span class="st">":memory:"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="couchdb">CouchDB<a class="anchor" aria-label="anchor" href="#couchdb"></a>
</h3>
<p>“Container” refers to a CouchDB database. Function <code>docdb_update.src_couchdb</code> uses <a href="https://cran.r-project.org/package=jqr" class="external-link">jqr</a> to implement patching JSON, in analogy to functions available for the other databases.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="reference/src_couchdb.html">src_couchdb</a></span><span class="op">(</span></span>
<span> host <span class="op">=</span> <span class="st">"127.0.0.1"</span>, port <span class="op">=</span> <span class="fl">5984L</span>, path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span> transport <span class="op">=</span> <span class="st">"http"</span>, user <span class="op">=</span> <span class="cn">NULL</span>, pwd <span class="op">=</span> <span class="cn">NULL</span>, headers <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="elasticsearch">Elasticsearch<a class="anchor" aria-label="anchor" href="#elasticsearch"></a>
</h3>
<p>“Container” refers to an Elasticsearch index. Only lowercase is accepted for container names. Opensearch can equally be used.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="reference/src_elastic.html">src_elastic</a></span><span class="op">(</span></span>
<span> host <span class="op">=</span> <span class="st">"127.0.0.1"</span>, port <span class="op">=</span> <span class="fl">9200L</span>, path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span> transport_schema <span class="op">=</span> <span class="st">"http"</span>, user <span class="op">=</span> <span class="cn">NULL</span>, pwd <span class="op">=</span> <span class="cn">NULL</span>, force <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="postgresql">PostgreSQL<a class="anchor" aria-label="anchor" href="#postgresql"></a>
</h3>
<p>“Container” refers to an PostgreSQL table. With PostgreSQL, the order of variables in data frames returned by <code><a href="reference/docdb_get.html">docdb_get()</a></code> and <code><a href="reference/docdb_query.html">docdb_query()</a></code> can differ from the order in which they were in <code><a href="reference/docdb_create.html">docdb_create()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">nodbi</span><span class="fu">::</span><span class="fu"><a href="reference/src_postgres.html">src_postgres</a></span><span class="op">(</span></span>
<span> dbname <span class="op">=</span> <span class="st">"my_database"</span>, host <span class="op">=</span> <span class="st">"127.0.0.1"</span>, port <span class="op">=</span> <span class="fl">5432L</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="walk-through">Walk-through<a class="anchor" aria-label="anchor" href="#walk-through"></a>
</h2>
<p>This example is meant to show how functional <code>nodbi</code> is at this time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load nodbi</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nodbi/" class="external-link">nodbi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># connect database backend; this</span></span>
<span><span class="co"># example fully works with any of</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_postgres.html">src_postgres</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_mongo.html">src_mongo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_sqlite.html">src_sqlite</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># parts of the example do not</span></span>
<span><span class="co"># yet work these, see *notes*</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_elastic.html">src_elastic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_couchdb.html">src_couchdb</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load data (here data frame, alternatively list or JSON)</span></span>
<span><span class="co"># into the container "my_container" specified in the "key" parameter</span></span>
<span><span class="fu"><a href="reference/docdb_create.html">docdb_create</a></span><span class="op">(</span><span class="va">src</span>, key <span class="op">=</span> <span class="st">"my_container"</span>, value <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span>
<span></span>
<span><span class="co"># load additionally 98 NDJSON records</span></span>
<span><span class="fu"><a href="reference/docdb_create.html">docdb_create</a></span><span class="op">(</span><span class="va">src</span>, key <span class="op">=</span> <span class="st">"my_container"</span>, <span class="st">"http://httpbin.org/stream/98"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: container 'my_container' already exists</span></span>
<span><span class="co">#&gt; [1] 98</span></span>
<span></span>
<span><span class="co"># load additionally contacts JSON data, from package nodbi</span></span>
<span><span class="fu"><a href="reference/docdb_create.html">docdb_create</a></span><span class="op">(</span><span class="va">src</span>, key <span class="op">=</span> <span class="st">"my_container"</span>, <span class="va">contacts</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: container 'my_container' already exists</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span></span>
<span><span class="co"># get all documents, irrespective of schema</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="fu"><a href="reference/docdb_get.html">docdb_get</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; A tibble: 135 × 27</span></span>
<span><span class="co">#&gt;    `_id`       isActive balance   age eyeColor name  email about registered tags   friends url  </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;lgl&gt;    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;list&gt; &lt;list&gt;  &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 5cd678530d… TRUE     $2,412…    20 blue     Kris… kris… Sint… 2017-07-1… &lt;chr&gt;  &lt;df&gt;    NA   </span></span>
<span><span class="co">#&gt;  2 5cd678531b… FALSE    $3,400…    20 brown    Rae … raec… Nisi… 2018-12-1… &lt;chr&gt;  &lt;df&gt;    NA   </span></span>
<span><span class="co">#&gt;  3 5cd6785325… TRUE     $1,161…    22 brown    Pace… pace… Eius… 2018-08-1… &lt;chr&gt;  &lt;df&gt;    NA   </span></span>
<span><span class="co">#&gt;  4 5cd6785335… FALSE    $2,579…    30 brown    Will… will… Null… 2018-02-1… &lt;chr&gt;  &lt;df&gt;    NA   </span></span>
<span><span class="co">#&gt;  5 5cd67853f8… FALSE    $3,808…    23 green    Lacy… lacy… Sunt… 2014-08-0… &lt;chr&gt;  &lt;df&gt;    NA   </span></span>
<span><span class="co">#&gt;  6 6529d28a-c… NA       NA         NA NA       NA    NA    NA    NA         &lt;NULL&gt; &lt;NULL&gt;  http…</span></span>
<span><span class="co">#&gt;  7 6529d2a8-c… NA       NA         NA NA       NA    NA    NA    NA         &lt;NULL&gt; &lt;NULL&gt;  http…</span></span>
<span><span class="co">#&gt;  8 6529d2b2-c… NA       NA         NA NA       NA    NA    NA    NA         &lt;NULL&gt; &lt;NULL&gt;  http…</span></span>
<span><span class="co">#&gt;  9 6529d2c6-c… NA       NA         NA NA       NA    NA    NA    NA         &lt;NULL&gt; &lt;NULL&gt;  http…</span></span>
<span><span class="co">#&gt; 10 6529d2d0-c… NA       NA         NA NA       NA    NA    NA    NA         &lt;NULL&gt; &lt;NULL&gt;  http…</span></span>
<span><span class="co">#&gt; # … with 125 more rows, and 15 more variables: args &lt;named list&gt;, headers &lt;df[,4]&gt;,</span></span>
<span><span class="co">#&gt; #   origin &lt;chr&gt;, id &lt;int&gt;, mpg &lt;dbl&gt;, cyl &lt;dbl&gt;, disp &lt;dbl&gt;, hp &lt;dbl&gt;, drat &lt;dbl&gt;, wt &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   qsec &lt;dbl&gt;, vs &lt;dbl&gt;, am &lt;dbl&gt;, gear &lt;dbl&gt;, carb &lt;dbl&gt;</span></span>
<span></span>
<span><span class="co"># query some documents</span></span>
<span><span class="co"># *note*: such complex queries do not yet work with src_elasticsearch()</span></span>
<span><span class="fu"><a href="reference/docdb_query.html">docdb_query</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span>, query <span class="op">=</span> <span class="st">'{"mpg": {"$gte": 30}}'</span><span class="op">)</span></span>
<span><span class="co">#&gt;              _id mpg cyl disp  hp drat  wt qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1       Fiat 128  32   4   79  66  4.1 2.2   19  1  1    4    1</span></span>
<span><span class="co">#&gt; 2    Honda Civic  30   4   76  52  4.9 1.6   19  1  1    4    2</span></span>
<span><span class="co">#&gt; 3   Lotus Europa  30   4   95 113  3.8 1.5   17  1  1    5    2</span></span>
<span><span class="co">#&gt; 4 Toyota Corolla  34   4   71  65  4.2 1.8   20  1  1    4    1</span></span>
<span></span>
<span><span class="co"># query some fields from some documents; 'query' is a mandatory </span></span>
<span><span class="co"># parameter and is used here in its position in the signature</span></span>
<span><span class="co"># *note*: such complex queries do not yet work with src_elasticsearch()</span></span>
<span><span class="fu"><a href="reference/docdb_query.html">docdb_query</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span>, <span class="st">'{"mpg": {"$gte": 30}}'</span>, fields <span class="op">=</span> <span class="st">'{"wt": 1, "mpg": 1}'</span><span class="op">)</span></span>
<span><span class="co">#&gt;    wt mpg</span></span>
<span><span class="co">#&gt; 1 2.2  32</span></span>
<span><span class="co">#&gt; 2 1.6  30</span></span>
<span><span class="co">#&gt; 3 1.5  30</span></span>
<span><span class="co">#&gt; 4 1.8  34</span></span>
<span></span>
<span><span class="co"># query some subitem fields from some documents</span></span>
<span><span class="co"># (only simple queries so far implemented for Elasticsearch)</span></span>
<span><span class="co"># (only root, not subitems so far implemented for CouchDB)</span></span>
<span><span class="co"># *note*: such complex queries do not yet work with src_elasticsearch()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="reference/docdb_query.html">docdb_query</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span>, <span class="st">'</span></span>
<span><span class="st"> {"$or": [{"age": {"$lt": 21}}, </span></span>
<span><span class="st"> {"friends.name": {"$regex": "^B[a-z]{3,6}.*"}}]}'</span>, </span>
<span> fields <span class="op">=</span> <span class="st">'{"age": 1, "friends.name": 1}'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    4 obs. of 2 variables:</span></span>
<span><span class="co">#&gt; $ age : int 20 20 22 23</span></span>
<span><span class="co">#&gt; $ friends:'data.frame':  4 obs. of 1 variable:</span></span>
<span><span class="co">#&gt; ..$ name:List of 4</span></span>
<span><span class="co">#&gt; .. ..$ : chr "Pace Bell"</span></span>
<span><span class="co">#&gt; .. ..$ : chr "Yang Yates" "Lacy Chen"</span></span>
<span><span class="co">#&gt; .. ..$ : chr "Baird Keller" "Francesca Reese" "Dona Bartlett"</span></span>
<span><span class="co">#&gt; .. ..$ : chr "Wooten Goodwin" "Brandie Woodward" "Angelique Britt"</span></span>
<span></span>
<span><span class="co"># such queries can also be used for updating (patching) selected documents </span></span>
<span><span class="co"># with a new 'value'(s) from a JSON string, a data frame or a list</span></span>
<span><span class="fu"><a href="reference/docdb_update.html">docdb_update</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span>, value <span class="op">=</span> <span class="st">'{"vs": 9, "xy": [1, 2]}'</span>, query <span class="op">=</span> <span class="st">'{"carb": 3}'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="co"># *note*: such queries do not yet work with src_elasticsearch()</span></span>
<span><span class="fu"><a href="reference/docdb_query.html">docdb_query</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span>, <span class="st">'{"carb": {"$in": [1,3]}}'</span>, fields <span class="op">=</span> <span class="st">'{"vs": 1}'</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1 1 1 1 9 9 9 1 1 1</span></span>
<span><span class="fu"><a href="reference/docdb_get.html">docdb_get</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span><span class="op">)</span><span class="op">[</span><span class="fl">126</span><span class="op">:</span><span class="fl">130</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">27</span>, <span class="fl">28</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                  _id carb   xy</span></span>
<span><span class="co">#&gt; 126        Merc 280C    4 NULL</span></span>
<span><span class="co">#&gt; 127       Merc 450SE    3 1, 2</span></span>
<span><span class="co">#&gt; 128       Merc 450SL    3 1, 2</span></span>
<span><span class="co">#&gt; 129      Merc 450SLC    3 1, 2</span></span>
<span><span class="co">#&gt; 130 Pontiac Firebird    2 NULL</span></span>
<span></span>
<span><span class="co"># use with dplyr</span></span>
<span><span class="co"># *note* that dplyr includes a (deprecated) function src_sqlite</span></span>
<span><span class="co"># which would mask nodbi's src_sqlite, so it is excluded here</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span>, exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"src_sqlite"</span>, <span class="st">"src_postgres"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="fu"><a href="reference/docdb_get.html">docdb_get</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;    gear mean_mpg</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     3     16.1</span></span>
<span><span class="co">#&gt; 2     4     24.5</span></span>
<span><span class="co">#&gt; 3     5     21.4</span></span>
<span><span class="co">#&gt; 4    NA     NA</span></span>
<span></span>
<span><span class="co"># delete documents; query is optional parameter and has to be </span></span>
<span><span class="co"># specified for deleting documents instead of deleting the container</span></span>
<span><span class="co"># *note*: such complex queries does not yet work with src_couchdb() or src_elasticsearch()</span></span>
<span><span class="fu"><a href="reference/docdb_delete.html">docdb_delete</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span>, query <span class="op">=</span> <span class="st">'{"$or": {"gear": 5, "age": {"$gte": 22}}}'</span><span class="op">)</span></span>
<span><span class="co">#&gt; TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="reference/docdb_get.html">docdb_get</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 127</span></span>
<span></span>
<span><span class="co"># delete container from database</span></span>
<span><span class="fu"><a href="reference/docdb_delete.html">docdb_delete</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"my_container"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="benchmark">Benchmark<a class="anchor" aria-label="anchor" href="#benchmark"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/nodbi/" class="external-link">"nodbi"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">srcMongo</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_mongo.html">src_mongo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">srcSqlite</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_sqlite.html">src_sqlite</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">srcElastic</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_elastic.html">src_elastic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">srcCouchdb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_couchdb.html">src_couchdb</a></span><span class="op">(</span>user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"COUCHDB_TEST_USER"</span><span class="op">)</span>, pwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"COUCHDB_TEST_PWD"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">srcPostgres</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/src_postgres.html">src_postgres</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="st">"test"</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">'{"clarity": "SI1"}'</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="st">'{"cut": 1, "_id": 1, "clarity": "1"}'</span></span>
<span><span class="va">value</span> <span class="op">&lt;-</span> <span class="st">'{"clarity": "XYZ", "new": ["ABC", "DEF"]}'</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">12000</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">testFunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">query</span>, <span class="va">fields</span><span class="op">)</span> <span class="op">{</span></span>
<span> <span class="fu"><a href="reference/docdb_create.html">docdb_create</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span>, <span class="va">data</span><span class="op">)</span></span>
<span> <span class="co"># Elasticsearch needs a delay to process the data</span></span>
<span> <span class="fu"><a href="reference/docdb_create.html">docdb_create</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span>, <span class="st">"http://httpbin.org/stream/89"</span><span class="op">)</span></span>
<span> <span class="co"># Elasticsearch needs a delay to process the data</span></span>
<span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">src</span>, <span class="st">"src_elastic"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="reference/docdb_get.html">docdb_get</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="reference/docdb_query.html">docdb_query</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span>, query <span class="op">=</span> <span class="va">query</span>, fields <span class="op">=</span> <span class="va">fields</span><span class="op">)</span></span>
<span> <span class="fu"><a href="reference/docdb_update.html">docdb_update</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span>, value <span class="op">=</span> <span class="va">value</span>, query <span class="op">=</span> <span class="va">query</span><span class="op">)</span></span>
<span> <span class="fu"><a href="reference/docdb_delete.html">docdb_delete</a></span><span class="op">(</span><span class="va">src</span>, <span class="va">key</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#&gt; 2022-05-04 with 2015 mobile hardware </span></span>
<span><span class="co">#&gt; without any database optimisations</span></span>
<span><span class="fu">rbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rbenchmark/man/benchmark.html" class="external-link">benchmark</a></span><span class="op">(</span></span>
<span> MongoDB <span class="op">=</span> <span class="fu">testFunction</span><span class="op">(</span>src <span class="op">=</span> <span class="va">srcMongo</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">query</span>, <span class="va">fields</span><span class="op">)</span>,</span>
<span> RSQLite <span class="op">=</span> <span class="fu">testFunction</span><span class="op">(</span>src <span class="op">=</span> <span class="va">srcSqlite</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">query</span>, <span class="va">fields</span><span class="op">)</span>,</span>
<span> Elastic <span class="op">=</span> <span class="fu">testFunction</span><span class="op">(</span>src <span class="op">=</span> <span class="va">srcElastic</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">query</span>, <span class="va">fields</span><span class="op">)</span>,</span>
<span> CouchDB <span class="op">=</span> <span class="fu">testFunction</span><span class="op">(</span>src <span class="op">=</span> <span class="va">srcCouchdb</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">query</span>, <span class="va">fields</span><span class="op">)</span>,</span>
<span> PostgreSQL <span class="op">=</span> <span class="fu">testFunction</span><span class="op">(</span>src <span class="op">=</span> <span class="va">srcPostgres</span>, <span class="va">key</span>, <span class="va">value</span>, <span class="va">query</span>, <span class="va">fields</span><span class="op">)</span>,</span>
<span> replications <span class="op">=</span> <span class="fl">10L</span>,</span>
<span> columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'test'</span>, <span class="st">'replications'</span>, <span class="st">'elapsed'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;         test replications elapsed</span></span>
<span><span class="co">#&gt; 4    CouchDB           10    1639</span></span>
<span><span class="co">#&gt; 3    Elastic           10     183 # 10s to be subtracted</span></span>
<span><span class="co">#&gt; 1    MongoDB           10      74</span></span>
<span><span class="co">#&gt; 5 PostgreSQL           10      81</span></span>
<span><span class="co">#&gt; 2    RSQLite           10      76</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_package.html" class="external-link">test_local</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># ✔ | F W S  OK | Context</span></span>
<span><span class="co"># ✔ |        84 | couchdb [90.8s]                                                                             </span></span>
<span><span class="co"># ✔ |     1  62 | elastic [68.9s]                                                                             </span></span>
<span><span class="co"># ────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co"># Skip (core-nodbi.R:138:3): docdb_query</span></span>
<span><span class="co"># Reason: queries need to be translated into elastic syntax</span></span>
<span><span class="co"># ────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co"># ✔ |        84 | mongodb [4.4s]                                                                              </span></span>
<span><span class="co"># ✔ |        83 | postgres [7.2s]                                                                             </span></span>
<span><span class="co"># ✔ |        84 | sqlite [4.2s]                                                                               </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ══ Results ═════════════════════════════════════════════════════════════════════════════════════════════════</span></span>
<span><span class="co"># Duration: 175.5 s</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ── Skipped tests  ──────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co"># • queries need to be translated into elastic syntax (1)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># [ FAIL 0 | WARN 0 | SKIP 1 | PASS 397 ]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<ul>
<li>Please <a href="https://github.com/ropensci/nodbi/issues" class="external-link">report any issues or bugs</a>.</li>
<li>License: MIT</li>
<li>Get citation information for <code>nodbi</code> in R doing <code>citation(package = 'nodbi')</code>
</li>
<li>Please note that this package is released with a <a href="https://ropensci.org/code-of-conduct/" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</li>
<li>Support for redis has been removed since version 0.5, because no way was found to query and update specific documents in a container.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=nodbi" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ropensci/nodbi/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ropensci/nodbi/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nodbi</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ralf Herold <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-8148-6748" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Scott Chamberlain <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-1444-9135" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Rich FitzJohn <br><small class="roles"> Author </small>  </li>
<li>Jeroen Ooms <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=nodbi" class="external-link"><img src="https://cranchecks.info/badges/worst/nodbi" alt="CRAN"></a></li>
<li><a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
<li><a href="https://cranchecks.info/pkgs/nodbi" class="external-link"><img src="https://cranchecks.info/badges/worst/nodbi" alt="cran checks"></a></li>
<li><a href="https://github.com/ropensci/nodbi/actions?query=workflow%3AR-CMD-check" class="external-link"><img src="https://github.com/ropensci/nodbi/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/ropensci/nodbi" class="external-link"><img src="https://codecov.io/gh/ropensci/nodbi/branch/master/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://github.com/r-hub/cranlogs.app" class="external-link"><img src="http://cranlogs.r-pkg.org/badges/nodbi" alt="rstudio mirror downloads"></a></li>
<li><a href="https://cran.r-project.org/package=nodbi" class="external-link"><img src="https://www.r-pkg.org/badges/version/nodbi" alt="cran version"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Ralf Herold, Scott Chamberlain, Rich FitzJohn, Jeroen Ooms.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
